<!DOCTYPE html>

<html>
    <head>
        <title>meditation remediation</title>

		<link rel="stylesheet" href="https://oylo.info/css/site-wide/directory-header.css">
		<link rel="stylesheet" href="assets/css/styles.css">
        
		<script src="assets/javascript/jquery.js"></script>
		<script src="assets/javascript/sound.js"></script>
		<script src="https://oylo.info/javascript/links_for_directory_header.js"></script>
    </head>
    
	<body class="page_body" onload="load_directory_header('https://crossorigin.me/https://oylo.info/resources/templates/directory_header.html'); fill_time_selects();">
		<div id="directory_header"></div>
		
		<div class="contained_containers">
			<div class="load_user_settings_container container_container">
				<p class="settings_message">load / save settings</p>

				<input class="user_input" type="text" placeholder=" username">
				<div class="settings_buttons_container">
					<input class="load_settings settings_button button" type="button" value="load settings" onclick="load_settings()">
					<input class="save_settings settings_button button" type="button" value="save settings" onclick="save_settings()">
				</div>
			</div>

			<div class="main_content_container container_container">
				<div class="settings_container">
					<p class="current_user">settings</p>

					<select class="select_hours time_select" onchange="calculate_time()"></select>
					<select class="select_minutes time_select" onchange="calculate_time()"></select>
					
					<ul class="theme_options">
						<li><input class="theme_option_light theme_option button" type="button"></li>
						<li><input class="theme_option_warm theme_option button" type="button"></li>
						<li><input class="theme_option_dark theme_option button" type="button"></li>
					</ul>
				</div>
			</div>
		</div>
		
		<div class="timer_container container_container">
			<p class="time_left">00:00:00</p>
			
			<input class="start_timer button" type="button" value="start session" onclick="set_time()">
			
			<p class="advance_link">advance by 5 minutes</p>
		</div>
    </body>

    <script>
        var current_user = "";
        var theme = "light";
        var ending_audio = "";
        var beginning_audio = "";
        var amount_of_time = 10;
		var timer;
		var timer_state = "timer_stopped";
		
		String.prototype.hhmmss = function() {
			var sec_num = parseInt(this, 10);
			var hours = Math.floor(sec_num / 3600);
			var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
			var seconds = sec_num - (hours * 3600) - (minutes * 60);

			if (hours < 10) { hours   = "0" + hours; }
			if (minutes < 10) { minutes = "0" + minutes; }
			if (seconds < 10) { seconds = "0" + seconds; }
			
			return hours + ':' + minutes + ':' + seconds;
		}
        
        function load_settings() {
            if ($('.user_input').val().trim()) {
                //access firebase
            } else {
                $('.settings_message').text('enter a user to load settings for');
            }
			
			reset_settings_message();
        }
        
        function save_settings(user_save, theme_save, ending_audio_save, beginning_audio_save, time_save) {
			if ($('.user_input').val().trim()) {
				//access firebase
				$('.settings_message').text('settings for ' + $('.user_input').val().trim() + ' saved');
				$('.current_user').text('settings for ' + $('.user_input').val().trim());
				$('.user_input').val('');
			} else {
				$('.settings_message').text('enter a user to save settings for');
			}
			
			reset_settings_message();
        }
		
		function reset_settings_message() {
			setTimeout(function() { $('.settings_message').text('load / save settings'); }, 3500);
		}
        
        function change_theme(theme_option) {
            theme = theme_option;
            
            //hotswap css file
        }
		
		function calculate_time() {
			amount_of_time = (parseInt($('.select_hours').val(), 10) * 3600) + (parseInt($('.select_minutes').val(), 10) * 60);

			$('.time_left').text(amount_of_time.toString().hhmmss());
			$('.advance_link').css({'color':'lightslategrey'});
		}
		
		function set_time() {
			if (timer_state === "timer_set") {
				timer_state = "timer_stopped";
				
				clearInterval(timer);
				
				amount_of_time = 0;
				
				$('.time_left').text(amount_of_time.toString().hhmmss());
				$('.advance_link').css({'color':'crimson'});
				$('.select_hours, .select_minutes').empty();
				$('.start_timer').val('start session');
				
				fill_time_selects();
			} else if (timer_state === "timer_stopped") {
				if (amount_of_time > 0) {
					timer_state = "timer_set";
					clearInterval(timer);
					timer = setInterval("update_time()", 1000);

					$('.advance_link').css({'color':'lightslategrey'});
					$('.settings_message').text('load / save settings');
					$('.start_timer').val('stop session');
				} else {
					$('.settings_message').text('how long do you want to meditate?');
					
					reset_settings_message();
				}
			}
		}
        
        function update_time() {
			amount_of_time--;
            
            $('.time_left').text(amount_of_time.toString().hhmmss());
            
			if (amount_of_time <= 300) {
				$('.advance_link').css({'color':'crimson'});
			}
			
			if (amount_of_time === 0) {
				timer_state = "timer_stopped";

				clearInterval(timer);
				
				$('.advance_link').css({'color':'lightslategrey'});
				$('.select_hours, .select_minutes').empty();
				
				fill_time_selects();
				
				$.play_sound('resources/enders/ender-1.wav');
			}
        }
		
		function fill_time_selects() {
			for (var i = 0; i < 6; i++) {
				var select_option = i.toString();
				var option_html = '<option value="' + select_option + '">' + select_option + ' hours</option>';
				
				if (i === 1)
					option_html = '<option value="' + select_option + '">' + select_option + ' hour</option>';
				
				$('.select_hours').append(option_html);
			}
			
			for (var i = 0; i < 56; i += 5) {
				var select_option = i.toString();
				var option_html = '<option value="' + select_option + '">' + select_option + ' minutes</option>';

				$('.select_minutes').append(option_html);
			}
		}
		
		$(document).ready(function() {
			$('.advance_link').click(function() {
				if (amount_of_time > 300) {
					amount_of_time -= 300; 
					
					$('.time_left').text(amount_of_time.toString().hhmmss());
				} else {
					$('.advance_link').css({'color':'crimson'});
					$('.settings_message').text('whoops! can\'t do that right now');
					
					reset_settings_message();
				}
			}); 
		});
    </script>
</html>

<!-- what's up fam. quite the explorer, aren't you? -- oylo.info 2017 -->